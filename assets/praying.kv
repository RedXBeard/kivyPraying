#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import LangSpinner spinners.LangSpinner
#:import MonthSpinner spinners.MonthSpinner
#:import trans __main__.trans

<RoundedLabel>
    canvas.before:
        Color:
            rgba: get_color_from_hex('ffffff')
        Rectangle:
            pos: self.pos[0], self.pos[1]+sp(25)/2
            size: self.size[0], self.size[1]-sp(25)
        Rectangle:
            pos: self.pos[0]+sp(25)/2, self.pos[1]
            size: self.size[0]-sp(25), self.size[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]+self.height-sp(25)
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]+self.height-sp(25)
    padding: 20, 15
    size_hint_y: None
    text_size: self.size
    line_height: 1.5
    markup: True
    halign: 'left'
    valign: 'top'
    color: get_color_from_hex('#000000')
    height: sp(40)
    font_size: sp(20)

<RecordStar>
    canvas.before:
        Color:
            rgba: get_color_from_hex('ffffff')
        Rectangle:
            pos: self.pos[0], self.pos[1]+sp(25)/2
            size: self.size[0], self.size[1]-sp(25)
        Rectangle:
            pos: self.pos[0]+sp(25)/2, self.pos[1]
            size: self.size[0]-sp(25), self.size[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]+self.height-sp(25)
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]+self.height-sp(25)
    size_hint_y: None
    height: sp(40)
    padding: 20, 15
            
<CheckBox>
    canvas.before:
        Color:
            rgba: get_color_from_hex('ffffff')
        Rectangle:
            pos: self.pos[0], self.pos[1]+sp(25)/2
            size: self.size[0], self.size[1]-sp(25)
        Rectangle:
            pos: self.pos[0]+sp(25)/2, self.pos[1]
            size: self.size[0]-sp(25), self.size[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0], self.pos[1]+self.height-sp(25)
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]
        Ellipse:
            size: sp(25), sp(25)
            pos: self.pos[0]+self.width-sp(25), self.pos[1]+self.height-sp(25)

<NewDateTextInput>
    canvas.after:
        Color:
            rgba: get_color_from_hex('#ffffff')
        Rectangle:
            pos: self.pos[0]-sp(20)/2, self.pos[1]+sp(20)/2
            size: sp(20), sp(10)
        Rectangle:
            pos: self.pos[0]+self.width-sp(20)/2, self.pos[1]+sp(20)/2
            size: sp(20), sp(10)
        Ellipse:
            size: sp(20), sp(20)
            pos: self.pos[0]-sp(20)/2, self.pos[1]
        Ellipse:
            size: sp(20), sp(20)
            pos: self.pos[0]-sp(20)/2, self.pos[1]+self.height-sp(20)
        Ellipse:
            size: sp(20), sp(20)
            pos: self.pos[0]+self.width-sp(20)/2, self.pos[1]
        Ellipse:
            size: sp(20), sp(20)
            pos: self.pos[0]+self.width-sp(20)/2, self.pos[1]+self.height-sp(20)
    text: ''
    size_hint_y: None
    padding: sp(20)/2, 15, 15, 15
    height: sp(30)
    multiline: False
    foreground_color: 0, 0, 0, 1
    background_color: 1, 1, 1, 1
    cursor_color: get_color_from_hex('#000000')
    background_disabled_normal: ""
    background_normal: ""
    background_active: ""

<GridLayout>
    spacing: 15, 15

<DateLine>
    GridLayout
        cols: 3
        rows: 1
        padding: 50, 30, 50, 30
        spacing: 30, 30

        pos_hint: {'center_y': .2}

        NewDateTextInput:
            id: day
            name: 'day'
            size_hint_x: .35
            hint_text: trans._('Gün')

        MonthSpinner:
            id: month
            values: trans._('Ocak'), trans._('Şubat'), trans._('Mart'), trans._('Nisan'), trans._('Mayıs'), trans._('Haziran'), trans._('Temmuz'), trans._('Ağustos'), trans._('Eylül'), trans._('Ekim'), trans._('Kasım'), trans._('Aralık')
            size_hint_y: None
            height: sp(30)
            sync_height: True
            halign: 'center'
            font_size: sp(15)
            text_autoupdate: True

        NewDateTextInput:
            id: year
            name: 'year'
            size_hint_x: .35
            hint_text: trans._('Yıl')

    GridLayout
        cols: 3
        rows: 1
        padding: 30, 30, 30, 30
        spacing: 30, 30
        pos_hint: {'center_y': .13}
        NewDateButton:
            text: trans._('İptal')
            name: 'new_record_cancel'
            halign: 'center'
            size_hint_y: None
            height: sp(30)
            font_size: sp(15)
            padding: 0, 10
            size_hint_x: .4

        Widget:
            size_hint_y: None
            height: sp(30)

        NewDateButton:
            month: month
            year: year
            day: day
            text: trans._('Ekle')
            name: 'new_record_add'
            halign: 'center'
            size_hint_y: None
            height: sp(30)
            font_size: sp(15)
            padding: 0, 10
            size_hint_x: .4


<Praying>
    welcome: welcome
    entrance: entrance
    data: data

    Screen:
        id: welcome
        name: 'welcome'
        progressbar: progressbar

        GridLayout:
            rows: 3
            cols: 1
            padding: 15, 15, 15, 15
            spacing: sp(40), sp(40)

            Image:
                source: 'assets/prayerapp.png'
                valign: 'center'

            ProgressBar:
                id: progressbar
                max: 1000
                value: 0
                size_hint_y: None
                height: sp(40)

            Widget:

    Screen:
        id: entrance
        name: 'entrance'
        times: times
        missed: missed
        today: today
        info: info
        city_selection: city_selection
        lang_selection: lang_selection

        sabah: sabah
        ogle: ogle
        ikindi: ikindi
        aksam: aksam
        yatsi: yatsi
        vitr: vitr

        GridLayout:
            cols: 1
            rows: 6

            padding: 15, 15, 15, 15
            spacing: sp(40), sp(40)

            GridLayout:
                cols: 3
                rows: 1
                size_hint_y: None
                height: sp(0)

                CitySpinner:
                    canvas.before:
                        Color:
                            rgba: get_color_from_hex('D2D1BE')
                    id: city_selection
                    size_hint: None, None
                    height: sp(30)
                    width: sp(120)
                    sync_height: True
                    halign: 'center'
                    font_size: sp(15)
                    text_autoupdate: True
                Widget:
                LangSpinner:
                    canvas.before:
                        Color:
                            rgba: get_color_from_hex('D2D1BE')
                    id: lang_selection
                    size_hint: None, None
                    height: sp(30)
                    width: sp(120)
                    values: 'Türkçe', 'English'
                    text_size: self.size
                    sync_height: True
                    halign: 'center'
                    font_size: sp(15)
                    text_autoupdate: True


            RoundedLabel:
                id: today
                name: 'today'
                halign: 'center'
                text: '{0} {1} {2}, {3}'.format(root.day, (root.month == 1 and trans._('Ocak') or root.month == 2 and trans._('Şubat') or root.month == 3 and trans._('Mart') or root.month == 4 and trans._('Nisan') or root.month == 5 and trans._('Mayıs') or root.month == 6 and trans._('Haziran') or root.month == 7 and trans._('Temmuz') or root.month == 8 and trans._('Ağustos') or root.month == 9 and trans._('Eylül') or root.month == 10 and trans._('Ekim') or root.month == 11 and trans._('Kasım') or root.month == 12 and trans._('Aralık') or ''), root.year, (root.weekday == 0 and trans._('Pazartesi') or root.weekday == 1 and trans._('Salı') or root.weekday == 2 and trans._('Çarsamba') or root.weekday == 3 and trans._('Perşembe') or root.weekday == 4 and trans._('Cuma') or root.weekday == 5 and trans._('Cumartesi') or root.weekday == 6 and trans._('Pazar') or ''))

            GridLayout:
                id: times
                name: 'times'

                cols: 2
                rows: 3

                spacing: sp(20), sp(20)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Sabah')
                    PrayedCheckBox:
                        id: sabah
                        name: 'sabah'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Ogle')
                    PrayedCheckBox:
                        id: ogle
                        name: 'ogle'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Ikindi')
                    PrayedCheckBox:
                        id: ikindi
                        name: 'ikindi'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Aksam')
                    PrayedCheckBox:
                        id: aksam
                        name: 'aksam'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Yatsi')
                    PrayedCheckBox:
                        id: yatsi
                        name: 'yatsi'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

                GridLayout:
                    cols: 2
                    rows: 1
                    spacing: sp(-20), sp(0)
                    size_hint_y: None
                    height: sp(40)
                    RoundedLabel:
                        text: trans._('Vitr')
                    PrayedCheckBox:
                        id: vitr
                        name: 'vitr'
                        size_hint: None, None
                        height: sp(40)
                        width: sp(40)

            GridLayout:
                canvas.before:
                    Color:
                        rgba: get_color_from_hex('ffffff')
                    Rectangle:
                        pos: self.pos[0], self.pos[1]+sp(25)/2
                        size: self.size[0], self.size[1]-sp(25)
                    Rectangle:
                        pos: self.pos[0]+sp(25)/2, self.pos[1]
                        size: self.size[0]-sp(25), self.size[1]
                    Ellipse:
                        size: sp(25), sp(25)
                        pos: self.pos[0], self.pos[1]
                    Ellipse:
                        size: sp(25), sp(25)
                        pos: self.pos[0], self.pos[1]+self.height-sp(25)
                    Ellipse:
                        size: sp(25), sp(25)
                        pos: self.pos[0]+self.width-sp(25), self.pos[1]
                    Ellipse:
                        size: sp(25), sp(25)
                        pos: self.pos[0]+self.width-sp(25), self.pos[1]+self.height-sp(25)
                id: info
                rows: 1
                cols: 5

                hours: hours
                minutes: minutes
                seconds: seconds
                size_hint_y: None
                height: sp(40)

                RoundedLabel:
                    id: hours
                    halign: 'right'
                    text: '23'

                RoundedLabel:
                    halign: 'center'
                    text: ':'
                    size_hint_x: None
                    width: sp(10)

                RoundedLabel:
                    id: minutes
                    halign: 'center'
                    text: '59'
                    size_hint_x: None
                    width: sp(50)

                RoundedLabel:
                    halign: 'center'
                    text: ':'
                    size_hint_x: None
                    width: sp(10)

                RoundedLabel:
                    id: seconds
                    halign: 'left'
                    text: '59'

            GridLayout:
                id: missed

                missed_sabah: missed_sabah
                missed_ogle: missed_ogle
                missed_ikindi: missed_ikindi
                missed_aksam: missed_aksam
                missed_yatsi: missed_yatsi
                missed_vitr: missed_vitr

                cols: 6
                rows: 1

                spacing: sp(10), sp(10)
                size_hint_y: None
                height: sp(50)

                GridLayout:
                    id: missed_sabah
                    name: 'sabah'

                    sabah_count: sabah_count
                    sabah_button: sabah_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._('Sabah')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: sabah_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: sabah_button
                        name: 'sabah'
                        size_hint_y: None
                        height: sp(30)

                GridLayout:
                    id: missed_ogle
                    name: 'ogle'

                    ogle_count: ogle_count
                    ogle_button: ogle_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._(u'Ogle')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: ogle_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: ogle_button
                        name: 'ogle'
                        size_hint_y: None
                        height: sp(30)

                GridLayout:
                    id: missed_ikindi
                    name: 'ikindi'

                    ikindi_count: ikindi_count
                    ikindi_button: ikindi_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._('Ikindi')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: ikindi_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: ikindi_button
                        name: 'ikindi'
                        size_hint_y: None
                        height: sp(30)

                GridLayout:
                    id: missed_aksam
                    name: 'aksam'

                    aksam_count: aksam_count
                    aksam_button: aksam_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._('Aksam')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: aksam_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: aksam_button
                        name: 'aksam'
                        size_hint_y: None
                        height: sp(30)

                GridLayout:
                    id: missed_yatsi
                    name: 'yatsi'

                    yatsi_count: yatsi_count
                    yatsi_button: yatsi_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._('Yatsi')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: yatsi_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: yatsi_button
                        name: 'yatsi'
                        size_hint_y: None
                        height: sp(30)

                GridLayout:
                    id: missed_vitr
                    name: 'vitr'

                    vitr_count: vitr_count
                    vitr_button: vitr_button

                    cols: 1
                    rows: 3
                    size_hint_y: None
                    height: sp(30)
                    RoundedLabel:
                        text: trans._('Vitr')
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    RoundedLabel:
                        id: vitr_count
                        halign: 'center'
                        padding: 20, 10
                        height: sp(30)
                        font_size: sp(15)
                    MissedCheckBox:
                        id: vitr_button
                        name: 'vitr'
                        size_hint_y: None
                        height: sp(30)

            GridLayout:
                cols: 3
                rows: 1
                size_hint_y: None
                height: sp(60)

                ResetButton:
                    text: trans._('Sifirla')
                    halign: 'center'
                    size_hint_x: None
                    width: sp(150)
                    height: sp(30)
                    font_size: sp(15)
                    padding: 0, 10

                Widget:

                RecordButton:
                    text: trans._('Kayıtlar')
                    halign: 'center'
                    size_hint_x: None
                    width: sp(150)
                    height: sp(30)
                    font_size: sp(15)
                    padding: 0, 10


    Screen:
        id: data
        name: 'data'
        record: record
        missing_record: missing_record
        stars: stars

        GridLayout:
            cols: 1
            rows: 6
            padding: 10, 10, 10, 10

            GridLayout:
                cols: 3
                rows: 1
                size_hint_y: None
                height: sp(40)

                BackButton:
                    text: trans._('Geri')
                    halign: 'center'
                    size_hint_x: None
                    width: sp(60)
                    height: sp(30)
                    font_size: sp(15)
                    padding: 0, 10

                Widget:

                NewDateButton:
                    text: trans._('Kayıt Ekle')
                    name: 'new_record'
                    halign: 'center'
                    size_hint_x: None
                    width: sp(120)
                    height: sp(30)
                    font_size: sp(15)
                    padding: 0, 10
            
            BoxLayout:
                id: stars
                orientation: 'horizontal'
                spacing: 5, 5
                size_hint: 1, None
                height: sp(60)
                spacing: sp(20)
            
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: sp(15)
                Widget:
                    id: separator1
                    size_hint_y: None
                    height: sp(15)
                    canvas:
                        Color:
                            rgb: 0, 0, 0
                        Rectangle:
                            pos: sp(5), separator1.center_y
                            size: separator1.width, 1
                Label:
                    font_size: sp(10)
                    text: trans._('Eksikler')
                    padding: 0, 0
                    size_hint: None, None
                    text_size: self.size
                    width: sp(50)
                    line_height: 1
                    halign: 'center'
                    valign: 'center'
                    color: get_color_from_hex('#000000')
                    height: sp(15)
                Widget:
                    id: separator2
                    size_hint_y: None
                    height: sp(15)
                    canvas:
                        Color:
                            rgb: 0, 0, 0
                        Rectangle:
                            pos: separator2.x, separator2.center_y
                            size: separator2.width, 1
                
            ScrollView:
                id: scrlv1
                on_scroll_stop: root.load_more_missed_records()
                BoxLayout:
                    id: missing_record
                    orientation: 'vertical'
                    spacing: 5, 5
                    size_hint: 1, None
                    height: max(self.minimum_height, scrlv1.height)

            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: sp(15)
                Widget:
                    id: separator3
                    size_hint_y: None
                    height: sp(15)
                    canvas:
                        Color:
                            rgb: 0, 0, 0
                        Rectangle:
                            pos: sp(5), separator3.center_y
                            size: separator3.width, 1
                Label:
                    font_size: sp(10)
                    text: trans._('Tümü')
                    padding: 0, 0
                    size_hint: None, None
                    text_size: self.size
                    width: sp(50)
                    line_height: 1
                    halign: 'center'
                    valign: 'center'
                    color: get_color_from_hex('#000000')
                    height: sp(15)
                Widget:
                    id: separator4
                    size_hint_y: None
                    height: sp(15)
                    canvas:
                        Color:
                            rgb: 0, 0, 0
                        Rectangle:
                            pos: separator4.x, separator4.center_y
                            size: separator4.width, 1
                
            ScrollView:
                id: scrlv2
                on_scroll_stop: root.load_more_records()
                BoxLayout:
                    id: record
                    orientation: 'vertical'
                    spacing: 5, 5
                    size_hint: 1, None
                    height: max(self.minimum_height, scrlv2.height)
